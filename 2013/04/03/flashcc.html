<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]--> <!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if IE 8]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]--> <head> <meta charset="utf-8"> <!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]--> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="author" content="Yu Wang"> <meta name="description" content="Personal blog for YuWang, a software engineer based in HeiFei,AnHui,China."/> <meta name="keywords" content="yuwang,Flash"/> <title>FlashCC学习札记 - YuWang</title> <link href='/assets/css/blog-style.css' rel="stylesheet" type="text/css"> <link href="/rss.xml" rel="alternate" title="YuWang" type="application/rss+xml"> <!--[if IE]><script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script> <script>window.Modernizr||document.write('<script src="/assets/js/modernizr-2.0.6.min.js"><\/script>');</script><![endif]--> <!--[if !IE]>--> <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script> <script>window.Modernizr||document.write('<script src="/assets/js/modernizr-2.6.2.min.js"><\/script>');</script> <!--<![endif]--> <script>if(!navigator.userAgent.match(/.*(Pingdom|PhantomJS|StatusCake).*/gi)){var _hmt=_hmt||[];(function(){var b=document.createElement("script");b.src="//hm.baidu.com/hm.js?1096ce63809d64d11df8da9b7c7d3ca9";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})()}(function(j,a,h){var i=h.prototype.open,e=h.prototype.send,k;j.hj=j.hj||function(){(j.hj.q=j.hj.q||[]).push(arguments)};j._hjSettings={hjid:12350,hjsv:2};function d(){j.hj.documentHtml=a.documentElement.outerHTML;k=a.createElement("script");k.async=1;k.src="//static.hotjar.com/c/hotjar-12350.js?sv=2";a.getElementsByTagName("head")[0].appendChild(k)}if(a.readyState==="interactive"||a.readyState==="complete"||a.readyState==="loaded"){d()}else{if(a.addEventListener){a.addEventListener("DOMContentLoaded",d,false)}}if(!j._hjPlayback&&a.addEventListener){h.prototype.open=function(c,g,b,n,f){this._u=g;i.call(this,c,g,b,n,f)};h.prototype.send=function(f){var b=this;function c(){if(b.readyState===4){j.hj("_xhr",b._u,b.status,b.response)}}this.addEventListener("readystatechange",c,false);e.call(this,f)}}})(window,document,window.XMLHttpRequest);</script> </head> <body> <!--[if IE]><p class="site-notice">You are using an outdated browser. Please <a href="http://browsehappy.com/" target="_blank">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true" target="_blank">activate Google Chrome Frame</a> to improve your experience.</p><![endif]--> <noscript> <p class="site-notice">This site requires JavaScript. Here are the instructions <a href="http://www.enable-javascript.com/" target="_blank">how to enable JavaScript in your web browser</a>.</p> </noscript> <div class="nav-wrapper"> <div class="nav-form"> <span class="overlay-header menu">Menu</span> <a class="btn-close">Close</a> <div class="results"> <a href="/archives">Archives</a> <a href="/tags">Tags</a> <a href="/">About</a> </div> </div> </div> <div class="search-wrapper"> <div class="search-form"> <input type="text" class="overlay-header search-field" placeholder="Search..."> <a class="btn-close">Close</a> <ul class="results"></ul> </div> </div> <div id="page" class="hentry"> <header class="the-header"> <div class="unit-head"> <div class="unit-inner unit-head-inner"> <nav class="nav-global"> <ul> <li class="logo nav-link"> <button class="btn-menu" data-ga="Menu"></button> <a href="/">YuWang</a> <!--[if !IE]>--><button class="btn-search" data-ga="Search"></button><!--<![endif]--> </li> <li class="nav-link"><a data-ga="Archives" href="/archives">Archives</a></li> <li class="nav-link"><a data-ga="Tags" href="/tags">Tags</a></li> <!--[if !IE]>--><li class="nav-link"><a data-ga="Search" class="btn-search" href="#">Search</a></li><!--<![endif]--> </ul> </nav> </div> </div> </header> <div class="body animated fadeInDown" role="main"> <div class="unit-body"> <div class="unit-inner unit-body-inner"> <div class="entry-content"> <article class="unit-article layout-post"> <div class="unit-inner unit-article-inner"> <div itemscope itemtype="http://schema.org/Article" class="content"> <header> <div class="unit-head"> <div class="unit-inner unit-head-inner"> <h1 itemprop="name" class="entry-title">FlashCC学习札记</h1> </div> </div> </header> <div class="bd"> <div class="entry-content"> <div class="meta"> <p class="date-publish"> Published: <time itemprop="datePublished" class="date-pub updated" title="2013-04-03T00:00:00+08:00" datetime="2013-04-03T00:00:00+08:00">April 03, 2013 </time> by <a class="author" href="/" rel="author"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Yu Wang</span></span></a> <a class="license image-link" rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank"> <img alt="Creative Commons Licence" style="border-width:0" src="/assets/images/cc-by-sa.png" height="16" width="80"/> </a> </p> <ul class="list-category list-linear"> <li class="list-head">Categories: </li> </ul> <ul class="list-tag list-linear"> <li class="list-head">Tags: </li> <li> <a data-ga="Flash" href="/tags/#Flash" title="Flash">Flash <span>1</span></a> </li> </ul> </div> <div itemprop="articleBody"> <p>前段时间项目中有一个功能模块用到了FlashCC，将C++的代码编译成swc文件，以便在Flash工程中使用。开发过程中遇到一些问题，现在记录下来，以便日后查阅。</p> <h2 class="custom-h2">一、开发环境搭建</h2> <p><strong>说明:本文所使用的FlashCC版本为1.0.1， 操作系统为Windows7 Professional 32位</strong></p> <p>相对于FlashCC的前身Alchemy来说，FlashCC的开发环境搭建已经简化了许多，一些开发过程中依赖的组件已经默认集成到官方提供的定制Cygwin当中。首先需要注意最小系统需求，下面是官方给出的标准：</p> <ul> <li><span style="color: #ff0000;">Flash Player 11 or higher </span></li> <li><span style="color: #ff0000;">Flex SDK 4.6 or higher</span></li> <li>Java Virtual Machine (64-bit)</li> <li>Window平台需要：Microsoft&reg; Windows&reg; 7 (64-bit edition)</li> </ul> <p><span style="color: #ff0000;">其中前两点必须要满足。</span>至于后两点，我的开发机器用的是Win7 32位系统，装的Java虚拟机也是32位的，实际操作中也没有发现太大问题(不过建议有条件的话最好还是使用官方标准)。</p> <p>了解基本需求后到各个网站上下载<a href="http://www.adobe.com/devnet/flex/flex-sdk-download.html">Flex SDK</a>、<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JRE</a>、<a href="https://www.adobe.com/products/gaming/tools.html">FlashCC开发包</a>(<a href="http://gamingdl.adobe.com/flascc/FlasCC_1.0.1.zip">1.0.1版本</a>)，下载完成后继续下面的步骤:</p> <p>1、解压FlexSDK(本文中解压路径为F:\Flex\flex_sdk_4.6)</p> <p>2、安装JRE</p> <p>3、解压FlashCC开发包(已经内置了定制版的cygwin) (本文中解压路径为F:\Flash\FlasCC_1.0.1)</p> <p>4、使用文本编辑器打开F:\Flash\FlasCC_1.0.1\samples\Makefile.common， 修改FLASCC及FLEX变量为下面的值:</p> <p>FLASCC:=/cygdrive/f/Flash/FlasCC_1.0.1/sdk <br/>FLEX:=/cygdrive/c/flex</p> <p>至此，FlashCC的开发环境就搭建好了，下面来尝试编译FlashCC开发包中自带的示例程序。</p> <h2 class="custom-h2">二、编译样例程序</h2> <p>直接运行F:\Flash\FlasCC_1.0.1\run.bat，切换工作目录到01_HelloWorld下：</p> <p>注意:如果使用的是32位Java虚拟机，则需要修改一下01_HelloWorld下的Makefile, 在编译命令后加上-jvmopt=-Xmx1G</p> <div id="scid:8747F07C-CDE8-481f-B0DF-C6CFD074BF67:c3f1106c-5951-4f41-a3b5-bd4d0a774859" class="wlWriterEditableSmartContent" style="margin: 0px; display: inline; float: none; padding: 0px;"><a title="" href="http://images.cnitblog.com/blog/141415/201304/03131400-4859131f2ad5403183e2f9773589fe4a.png" rel="thumbnail"><img src="http://images.cnitblog.com/blog/141415/201304/03131402-8ac39c92aa8b40a1962e5d25bb05836f.png" alt="" width="580" height="201" border="0"/></a></div> <p>否则会报下面的错误:</p> <p>&ldquo;LLVM ERROR: Error: Unable to launch the Java Virtual Machine. <br/>This usually means you have a 32bit JVM installed or have set your Java heap siz <br/>e too large. <br/>Try lowering the Java heap size by passing "-jvmopt=-Xmx1G" to gcc/g++.&rdquo;</p> <p>在cygwin窗口中输入make：</p> <div id="scid:8747F07C-CDE8-481f-B0DF-C6CFD074BF67:84d5cd2a-4650-4cb5-a8c6-afc3d1785193" class="wlWriterEditableSmartContent" style="margin: 0px; display: inline; float: none; padding: 0px;"><a title="" href="http://images.cnitblog.com/blog/141415/201304/03131403-3cb154e8fe1a49689e3585c955e2188e.png" rel="thumbnail"><img src="http://images.cnitblog.com/blog/141415/201304/03131405-570880f6251a42aa84f1f3d5d8eb7682.png" alt="" width="580" height="404" border="0"/></a></div> <p>一切顺利的话，会在01_HelloWorld目录下多出hello.exe和hello.swf两个文件，使用FlashPlayer打开hello.swf，效果如下：</p> <div id="scid:8747F07C-CDE8-481f-B0DF-C6CFD074BF67:e374ea47-cfa4-44aa-a02b-d1e0c1f4f85b" class="wlWriterEditableSmartContent" style="margin: 0px; display: inline; float: none; padding: 0px;"><a title="" href="http://images.cnitblog.com/blog/141415/201304/03131406-469e0a2cd71049b2aa22c32a916967c4.png" rel="thumbnail"><img src="http://images.cnitblog.com/blog/141415/201304/03131406-c89796e9a24341f696262189edcbf72c.png" alt="" width="282" height="335" border="0"/></a></div> <p>&nbsp;</p> <h2 class="custom-h2">三、开发中遇到的问题</h2> <p>1、FlashCC使用cygwin编译代码，而cygwin是一个linux环境的模拟器，所以要求被编译的代码要使用标准C/C++。或者是做一些跨平台处理。</p> <p>2、一开始在项目中编译C++代码成swc文件之后，使用Flash Professional CS5.5建立以一个测试项目，实际运行的时候发现有个地方总是分配不到内存，后来在FlashCC官方论坛上提问，才发现是由于编译时指定的flash版本过低所致(FlashCC要求编译时flash版本最低为11), <a href="http://forums.adobe.com/message/5143930#5143930">论坛上的提问</a>。</p> <p>3、以前安装的Flash Professional CS5.5发布swf时flash版本最高只能指定到10.2，可以参考下面的文章来添加更高版本的flash支持</p> <p><a href="http://blogs.adobe.com/rgalvan/2011/11/adding-fp11-support-to-flash-pro-cs5-and-cs5-5.html">Adding Flash Player 11 support to Flash Pro CS5 and CS5.5</a></p> <p>4、关于从AS3代码中向C++中传递ByteArray参数的方法，一开始参考了<a href="http://stackoverflow.com/questions/14326828/how-to-pass-bytearray-to-c-code-using-flascc">这篇文章</a>，实际测试中发现这种方法在我编写的功能模块中并不能正确工作。后来采用官方Demo中的数据传递方法成功解决了ByteArray传参问题。贴出参考代码：</p> <div class="cnblogs_code" onclick="cnblogs_code_show('57502822-076c-45b4-b827-bb318b84c6eb')"><img id="code_img_closed_57502822-076c-45b4-b827-bb318b84c6eb" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""/><img id="code_img_opened_57502822-076c-45b4-b827-bb318b84c6eb" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('57502822-076c-45b4-b827-bb318b84c6eb',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt=""/><span class="cnblogs_code_collapse">AS3</span> <div id="cnblogs_code_open_57502822-076c-45b4-b827-bb318b84c6eb" class="cnblogs_code_hide"> <pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> First lets fill a ByteArray like we normally would in ActionScript </span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">var</span> bytes:ByteArray = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ByteArray(); 
</span><span style="color: #008080;"> 3</span> bytes.endian = <span style="color: #ff0000;">"littleEndian"</span><span style="color: #000000;">; 
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> j:int = 0; j &lt; 10; j++<span style="color: #000000;">) 
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">   bytes.writeInt(j);
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> bytes.position = 0<span style="color: #000000;">;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #008000;">//</span><span style="color: #008000;"> Now we want a pointer to that ByteArray </span>
<span style="color: #008080;">10</span> <span style="color: #0000ff;">var</span> bytesPtr:int =<span style="color: #000000;"> CModule.malloc(bytes.length);
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> <span style="color: #008000;">//</span><span style="color: #008000;"> Use CModule.writeBytes() to write the ByteArray we created into flascc's </span>
<span style="color: #008080;">13</span> <span style="color: #008000;">//</span><span style="color: #008000;"> main memory.  The parameters of writeBytes() are first the pointer in flascc </span>
<span style="color: #008080;">14</span> <span style="color: #008000;">//</span><span style="color: #008000;"> memory, the length of the ByteArray, and the ByteArray itself </span>
<span style="color: #008080;">15</span> <span style="color: #000000;">CModule.writeBytes(bytesPtr, bytes.length, bytes); 
</span><span style="color: #008080;">16</span> printLine(<span style="color: #ff0000;">"Checksum: "</span> +<span style="color: #000000;"> MyLib.examineBytes(bytesPtr, bytes.length)); 
</span><span style="color: #008080;">17</span> CModule.free(bytesPtr);</pre> </div> </div> <div class="cnblogs_code" onclick="cnblogs_code_show('ebe7f204-e7f4-4e34-952c-ad5d8bab8bb0')"><img id="code_img_closed_ebe7f204-e7f4-4e34-952c-ad5d8bab8bb0" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""/><img id="code_img_opened_ebe7f204-e7f4-4e34-952c-ad5d8bab8bb0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('ebe7f204-e7f4-4e34-952c-ad5d8bab8bb0',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt=""/><span class="cnblogs_code_collapse">C</span> <div id="cnblogs_code_open_ebe7f204-e7f4-4e34-952c-ad5d8bab8bb0" class="cnblogs_code_hide"> <pre><span style="color: #008080;"> 1</span> __attribute__((annotate(<span style="color: #800000;">"</span><span style="color: #800000;">as3sig:public function _wrap_examineBytes(buffer:int, bufferSize:int):int</span><span style="color: #800000;">"</span><span style="color: #000000;">))) 
</span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> _wrap_examineBytes() { 
</span><span style="color: #008080;"> 3</span>   unsigned <span style="color: #0000ff;">char</span> *arg1 = (unsigned <span style="color: #0000ff;">char</span> *) <span style="color: #800080;">0</span><span style="color: #000000;"> ; 
</span><span style="color: #008080;"> 4</span>   <span style="color: #0000ff;">int</span><span style="color: #000000;"> arg2 ; 
</span><span style="color: #008080;"> 5</span>   <span style="color: #0000ff;">int</span><span style="color: #000000;"> result ; 
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">  { 
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    AS3_GetScalarFromVar(arg1, buffer); 
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">  } 
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">  { 
</span><span style="color: #008080;">10</span> <span style="color: #000000;">    AS3_GetScalarFromVar(arg2, bufferSize); 
</span><span style="color: #008080;">11</span> <span style="color: #000000;">  } 
</span><span style="color: #008080;">12</span>   result = (<span style="color: #0000ff;">int</span>)examineBytes((unsigned <span style="color: #0000ff;">char</span> <span style="color: #0000ff;">const</span> *<span style="color: #000000;">)arg1,arg2); 
</span><span style="color: #008080;">13</span> <span style="color: #000000;">  { 
</span><span style="color: #008080;">14</span>     AS3_DeclareVar(asresult, <span style="color: #0000ff;">int</span><span style="color: #000000;">); 
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    AS3_CopyScalarToVar(asresult, result); 
</span><span style="color: #008080;">16</span> <span style="color: #000000;">  } 
</span><span style="color: #008080;">17</span> <span style="color: #000000;">  { 
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    AS3_ReturnAS3Var(asresult); 
</span><span style="color: #008080;">19</span> <span style="color: #000000;">  } 
</span><span style="color: #008080;">20</span> }</pre> </div> </div> <p>&nbsp;</p> <p>PS:附上FlashCC 官方论坛地址</p> <p><a title="http://forums.adobe.com/community/game_developers/flascc" href="http://forums.adobe.com/community/game_developers/flascc">http://forums.adobe.com/community/game_developers/flascc</a></p> <p>&nbsp;</p> <p><strong>版权说明：</strong><strong>本文章版权归本人及博客园共同所有，未经允许请勿用于任何商业用途。转载请标明原文出处:</strong></p> <p><a id="Editor_Edit_hlEntryLink" title="view: FlashCC学习札记" href="http://www.cnblogs.com/talywy/archive/2013/04/03/2997702.html" target="_blank">http://www.cnblogs.com/talywy/archive/2013/04/03/2997702.html</a></p> </div> </div> </div> <footer class="unit-foot"> <div class="unit-inner unit-foot-inner"> <div class="gotop"> <a class="internal" href="#page">Back to Top</a> <div class="addthis_toolbox addthis_default_style addthis_32x32_style"> <a class="addthis_button_email"></a> <a class="addthis_button_facebook"></a> <a class="addthis_button_google_plusone_share"></a> <a class="addthis_button_reddit"></a> <a class="addthis_button_twitter"></a> </div> <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid="></script> </div> <nav class="pagination"> <a class="internal" data-ga="Previous Post" rel="prev" href="/2013/03/07/syncronize-time-tool" title="View '时间同步小工具(Python + Windows Service + NSIS)'"> ← 时间同步小工具(Python + Windows Service + NSIS)</a> <a class="internal" data-ga="Next Post" rel="next" href="/2016/05/23/how-to-create-a-blog-like-this" title="View '如何创建一个和本站一样的站点'">如何创建一个和本站一样的站点 → </a> </nav> </div> </footer> <div class="misc-content"> <div class="comment"> <button class="center-block show-hidden" data-ga="Show Comments" data-disqus-url="http://yuwang.tech/2013/04/03/flashcc/">Show Comments</button> <div id="disqus_thread"></div> </div> </div> </div> </div> </article> </div> </div> </div> </div> <footer class="the-footer"> <div class="unit-foot"> <div class="unit-inner unit-foot-inner"> <div class="misc vcard"> <div class="about"> <h4><a href="/#about">About</a></h4> <p> <span class="fn p-name">Yu Wang</span>, <span class="p-job-title">Software Engineer</span> <span> based in </span> <span class="adr h-adr p-adr"> <abbr class="locality p-locality">HeiFei, AnHui </abbr>, <abbr class="country-name p-country-name">China</abbr>. </span> </p> <p><a href="https://github.com/yizeng/yizeng.me#license" target="_blank">License</a> &amp; <a href="https://github.com/yizeng/yizeng.me/wiki/Acknowledgements" target="_blank">Acknowledgements</a></p> </div> <div class="social-links"> <a class="ico-linkedin" href="https://www.linkedin.com/in/talywy" rel="me" target="_blank" title="LinkedIn Profile"></a> <a class="ico-github" href="http://github.com/talywy/" rel="me" target="_blank" title="GitHub Page"></a> <a class="ico-gmail" href="mailto:taly.w.y@gmail.com" rel="me" target="_blank" title="Email Address"></a> <a class="ico-facebook" href="https://www.facebook.com/taly.w.y" rel="me" target="_blank" title="Facebook"></a> <a class="ico-rss" href="/rss.xml" rel="me" target="_blank" title="RSS Feeds"></a> </div> </div> </div> </div> <a href="#" class="internal back-to-top">Back to Top</a> </footer> </div> <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <script>window.jQuery||document.write('<script src="/assets/js/jquery-1.11.0.min.js"><\/script>');</script> <!--[if !IE]>--> <script src="//cdnjs.cloudflare.com/ajax/libs/pace/0.4.17/pace.min.js"></script> <script>window.Pace||document.write('<script src="/assets/js/pace.min.js"><\/script>');</script> <!--<![endif]--> <script>$(document).ready(function(){var c=50,b=500,a=960;$(window).scroll(function(){if($(window).width()>a){if($(this).scrollTop()>c){$("footer").css("top","20px");$("footer .back-to-top").fadeIn(b)}else{$("footer").css("top","auto");$("footer .back-to-top").fadeOut(b)}}});$(window).resize(function(){if($(window).width()<a){$("footer").css("top","auto");$("footer .back-to-top").fadeOut(b)}if($(window).width()>=a&&$(this).scrollTop()>c){$("footer").css("top","20px");$("footer .back-to-top").fadeIn(b)}});$("footer .back-to-top").click(function(d){d.preventDefault();$("html, body").animate({scrollTop:0},b);return false})});</script> <script src="/assets/js/jekyll-search.jquery.js"></script> <script>$(document).ready(function(){$(".search-field").simpleJekyllSearch({jsonFile:"/search.json",template:'<li><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></li>',searchResults:".search-wrapper .results",searchResultsTitle:"<h4>Search results</h4>",noResults:"<p>Oh shucks<br/><small>Nothing found :(</small></p>"})});(function(c,b,d){var a=function(){c(".nav-wrapper, .search-wrapper").removeAttr("style");c(".nav-form, .search-form").removeClass("active");c("body").removeClass("nav-overlay search-overlay")};c(".nav-global .btn-search").on("click",function(){c(".search-wrapper").css({display:"block"});c(".search-form").addClass("active");c(".search-form").find("input").focus();c("body").addClass("search-overlay")});c(".nav-global .btn-menu").on("click",function(){c(".nav-wrapper").css({display:"block"});c(".nav-form").addClass("active");c(".nav-form .search-field").prop("disabled",true);c("body").addClass("nav-overlay")});c(".nav-wrapper .btn-close, .search-wrapper .btn-close").on("click",function(){a()});c(document).on("keyup",function(f){if(f.keyCode===27){a()}})})(jQuery,window);</script> <script>$(document).ready(function(){var b="YPH1eKPOxomOQ3oYwjiDYWjb7RtoWdvgYrHmNH3xX23XsnfGFnNHl4JKKpa7CbH2";var c="yuwang";var a="link:"+$(".comment .show-hidden").attr("data-disqus-url");$.ajax({type:"GET",url:"https://disqus.com/api/3.0/threads/set.jsonp",data:{api_key:b,forum:c,thread:a},cache:false,dataType:"jsonp",success:function(d){if(d.response.length===1){btnText="Show Comments ("+d.response[0].posts+")";$(".comment .show-hidden").html(btnText)}}});$(".comment .show-hidden").on("click",function(){$.ajaxSetup({cache:true});$.getScript("http://"+c+".disqus.com/embed.js");$.ajaxSetup({cache:false});$(this).remove()});if(/\#comment/.test(location.hash)){$(".comment .show-hidden").trigger("click")}});</script> </body> </html>